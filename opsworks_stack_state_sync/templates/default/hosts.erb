# NOTE:
# This file has been modified to use private_dns_name for 127.0.0.1, instead of locahost
#
# The original file is in: 
#   https://github.com/aws/opsworks-cookbooks/blob/master-chef-11.4/opsworks_stack_state_sync/templates/default/hosts.erb
# Current OpsWorks recommendation for template override:
#   http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-template-override.html
#
# Not a great solution since it won't inherient the future change OpsWorks might make to this file, had to keep an eye on this
# file from now and keep up with the changes.
#
# This file was generated by OpsWorks
# any manual changes will be removed on the next update.

# The following lines are desirable for IPv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts

# ==== change begin =====
<% node[:opsworks][:instance][:custom_dns_entries].each do |entry| -%>
<%= entry[:ip] %> <%= entry[:dns_names] %>
<% end -%>
# ==== change end =====

# OpsWorks Layer State
127.0.0.1 localhost.localdomain localhost
127.0.1.1 <%= @localhost_name %>.localdomain <%= @localhost_name %>

<% @nodes.each do |node| -%>
<% if node.attributes.attribute?(:private_ip) && node.attributes.private_ip %>
<% if Resolv.getaddress(node.attributes.private_ip) -%>
<%= node.attributes.private_ip %> <%= node.name %> <%= node.hostname %>
<% else -%>
<%= "# Unable to resolve IP '#{node.attributes.private_ip}' for hostname '#{node.name}'" %>
<% end -%>
<% end -%>
<% if node.attributes.attribute?(:ip) && node.attributes.ip %>
<% if Resolv.getaddress(node.attributes.ip) -%>
<%= node.attributes.ip %> <%= node.name %>-ext <%= node.hostname %>-ext
<% else -%>
<%= "# Unable to resolve IP '#{node.attributes.ip}' for hostname '#{node.name}'" %>
<% end -%>
<% end -%>
<% end -%>
